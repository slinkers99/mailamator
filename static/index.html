<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mailamator</title>
    <script>
      (function() {
        var t = localStorage.getItem("mailamator-theme");
        if (!t) t = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
        document.documentElement.setAttribute("data-theme", t);
      })();
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <nav class="container">
            <ul>
                <li><strong class="app-title">Mailamator</strong></li>
            </ul>
            <ul>
                <li>
                    <select id="account-switcher" aria-label="Select account">
                        <option value="">No accounts</option>
                    </select>
                </li>
                <li>
                    <button id="theme-toggle" type="button" aria-label="Toggle theme" title="Toggle theme"></button>
                </li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <!-- Global error alert -->
        <div id="global-error" class="alert alert-error" role="alert" hidden>
            <span id="global-error-message"></span>
            <button type="button" class="alert-close" aria-label="Dismiss error">&times;</button>
        </div>

        <!-- Tab navigation -->
        <nav class="tab-nav" role="tablist" aria-label="Main navigation">
            <button role="tab" class="tab-btn" data-tab="settings" aria-selected="false" aria-controls="page-settings">Settings</button>
            <button role="tab" class="tab-btn" data-tab="domains" aria-selected="false" aria-controls="page-domains">Domains</button>
            <button role="tab" class="tab-btn" data-tab="users" aria-selected="false" aria-controls="page-users">Users</button>
            <button role="tab" class="tab-btn" data-tab="history" aria-selected="false" aria-controls="page-history">History</button>
        </nav>

        <!-- ========== SETTINGS PAGE ========== -->
        <section id="page-settings" role="tabpanel" aria-labelledby="tab-settings" hidden>
            <h2>Settings</h2>

            <article>
                <header><h3>Add Account</h3></header>
                <form id="form-add-account">
                    <div class="grid">
                        <label>
                            Account Name
                            <input type="text" name="name" placeholder="e.g. My Project" required>
                        </label>
                        <label>
                            Purelymail API Key
                            <input type="password" name="api_key" placeholder="API key" required>
                        </label>
                    </div>
                    <label>
                        Cloudflare API Token <small>(optional)</small>
                        <input type="password" name="cloudflare_token" placeholder="Cloudflare token">
                    </label>
                    <button type="submit">Add Account</button>
                </form>
                <div id="settings-add-status"></div>
            </article>

            <article>
                <header><h3>Existing Accounts</h3></header>
                <div id="settings-loading" class="loading" hidden>
                    <span aria-busy="true">Loading accounts...</span>
                </div>
                <div id="accounts-list"></div>
            </article>
        </section>

        <!-- ========== DOMAINS PAGE ========== -->
        <section id="page-domains" role="tabpanel" aria-labelledby="tab-domains" hidden>
            <h2>Domains</h2>

            <article>
                <header><h3>Add Domain</h3></header>
                <form id="form-add-domain">
                    <fieldset role="group">
                        <input type="text" name="domain_name" placeholder="example.com" required>
                        <button type="submit">Add Domain</button>
                    </fieldset>
                </form>
                <div id="domain-add-status"></div>
            </article>

            <!-- Domain add result card (hidden by default) -->
            <article id="domain-result-card" hidden>
                <header><h3>DNS Configuration for <span id="domain-result-name"></span></h3></header>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Name</th>
                                <th>Value</th>
                                <th>Priority</th>
                            </tr>
                        </thead>
                        <tbody id="domain-dns-records"></tbody>
                    </table>
                </div>
                <footer class="btn-group">
                    <button type="button" id="btn-download-zone" class="secondary">Download Zone File</button>
                    <button type="button" id="btn-push-cloudflare" class="contrast" hidden>Push to Cloudflare</button>
                </footer>
            </article>

            <article>
                <header><h3>Domain List</h3></header>
                <div id="domains-loading" class="loading" hidden>
                    <span aria-busy="true">Loading domains...</span>
                </div>
                <div id="domains-list"></div>
            </article>
        </section>

        <!-- ========== USERS PAGE ========== -->
        <section id="page-users" role="tabpanel" aria-labelledby="tab-users" hidden>
            <h2>Users</h2>

            <article>
                <header><h3>Create Users</h3></header>
                <form id="form-add-users">
                    <label>
                        Domain
                        <select id="users-domain-picker" name="domain_name" required>
                            <option value="">Select a domain</option>
                        </select>
                    </label>
                    <label>
                        Usernames <small>(one per line)</small>
                        <textarea name="usernames" rows="4" placeholder="alice&#10;bob&#10;carol" required></textarea>
                    </label>
                    <button type="submit">Create Users</button>
                </form>
                <div id="users-add-status"></div>
            </article>

            <!-- User creation result card (hidden by default) -->
            <article id="users-result-card" hidden>
                <header>
                    <div class="header-with-action">
                        <h3>Created Users</h3>
                        <button type="button" id="btn-copy-credentials" class="secondary outline btn-sm">Copy All</button>
                    </div>
                </header>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Password</th>
                                <th>Webmail</th>
                            </tr>
                        </thead>
                        <tbody id="users-created-table"></tbody>
                    </table>
                </div>
            </article>

            <!-- Mail settings (collapsible) -->
            <details id="mail-settings-details">
                <summary>Mail Client Settings</summary>
                <div id="mail-settings-content"></div>
            </details>

            <article>
                <header><h3>Existing Users</h3></header>
                <label>
                    Filter by domain
                    <select id="users-list-domain-picker" aria-label="Filter users by domain">
                        <option value="">Select a domain</option>
                    </select>
                </label>
                <div id="users-loading" class="loading" hidden>
                    <span aria-busy="true">Loading users...</span>
                </div>
                <div id="users-list"></div>
            </article>
        </section>

        <!-- ========== HISTORY PAGE ========== -->
        <section id="page-history" role="tabpanel" aria-labelledby="tab-history" hidden>
            <h2>History</h2>

            <div class="search-bar">
                <input type="search" id="history-search" placeholder="Search emails, domains..." aria-label="Search history">
            </div>

            <div id="history-loading" class="loading" hidden>
                <span aria-busy="true">Searching...</span>
            </div>

            <article>
                <header><h3>Created Users</h3></header>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Password</th>
                                <th>Domain</th>
                                <th>Account</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody id="history-users-table"></tbody>
                    </table>
                </div>
                <div id="history-users-empty" class="empty-state" hidden>No users found.</div>
            </article>

            <article>
                <header><h3>Created Domains</h3></header>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Domain</th>
                                <th>Account</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody id="history-domains-table"></tbody>
                    </table>
                </div>
                <div id="history-domains-empty" class="empty-state" hidden>No domains found.</div>
            </article>
        </section>
    </main>

    <script src="/static/app.js"></script>
</body>
</html>
