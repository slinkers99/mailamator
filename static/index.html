<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mailamator</title>
    <script>
      (function() {
        var t = localStorage.getItem("mailamator-theme");
        if (!t) t = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
        document.documentElement.setAttribute("data-theme", t);
      })();
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <nav class="container">
            <ul>
                <li><img src="/static/mailamator-logo.svg" alt="Mailamator logo" class="app-logo"><strong class="app-title">Mailamator</strong></li>
            </ul>
            <ul>
                <li>
                    <select id="account-switcher" aria-label="Select account">
                        <option value="">No accounts</option>
                    </select>
                </li>
                <li>
                    <a href="https://github.com/kgNatx/mailamator/issues" target="_blank" rel="noopener" id="feedback-link" title="Submit feedback" aria-label="Submit feedback"><svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0016 8c0-4.42-3.58-8-8-8z"/></svg> Feedback</a>
                </li>
                <li>
                    <button id="theme-toggle" type="button" aria-label="Toggle theme" title="Toggle theme"></button>
                </li>
            </ul>
        </nav>
        <nav class="tab-nav container" role="tablist" aria-label="Main navigation">
            <button role="tab" class="tab-btn" data-tab="settings" aria-selected="false" aria-controls="page-settings">Settings</button>
            <button role="tab" class="tab-btn" data-tab="domains" aria-selected="false" aria-controls="page-domains">Domains</button>
            <button role="tab" class="tab-btn" data-tab="users" aria-selected="false" aria-controls="page-users">Users</button>
            <button role="tab" class="tab-btn" data-tab="routing" aria-selected="false" aria-controls="page-routing">Routing</button>
            <button role="tab" class="tab-btn" data-tab="history" aria-selected="false" aria-controls="page-history">History</button>
        </nav>
    </header>

    <main class="container">
        <!-- Global error alert -->
        <div id="global-error" class="alert alert-error" role="alert" hidden>
            <span id="global-error-message"></span>
            <button type="button" class="alert-close" aria-label="Dismiss error">&times;</button>
        </div>

        <!-- ========== SETTINGS PAGE ========== -->
        <section id="page-settings" role="tabpanel" aria-labelledby="tab-settings" hidden>
            <h2>Settings</h2>

            <article>
                <details id="add-account-details" open>
                    <summary><strong>Add New Account</strong></summary>
                    <form id="form-add-account">
                        <div class="grid">
                            <label>
                                Account Name
                                <input type="text" name="name" placeholder="e.g. My Project" required>
                            </label>
                            <label>
                                Purelymail API Key
                                <input type="password" name="api_key" placeholder="API key" required>
                            </label>
                        </div>
                        <label>
                            Cloudflare API Token <small>(optional)</small>
                            <input type="password" name="cloudflare_token" placeholder="Cloudflare token">
                        </label>
                        <div class="field-hint">
                            To push DNS records automatically, your domain must use Cloudflare's nameservers. Add your domain to Cloudflare and update your registrar's nameservers <em>before</em> using the "Push to Cloudflare" feature. The token needs <strong>Zone:DNS:Edit</strong> permission.
                        </div>
                        <button type="submit">Add Account</button>
                    </form>
                    <div id="settings-add-status"></div>
                </details>
            </article>

            <article>
                <header><h3>Existing Accounts</h3></header>
                <div id="settings-loading" class="loading" hidden>
                    <span aria-busy="true">Loading accounts...</span>
                </div>
                <div id="accounts-list"></div>
            </article>
        </section>

        <!-- ========== DOMAINS PAGE ========== -->
        <section id="page-domains" role="tabpanel" aria-labelledby="tab-domains" hidden>
            <h2>Domains</h2>

            <article>
                <header><h3>Add Domain</h3></header>
                <form id="form-add-domain">
                    <fieldset role="group">
                        <input type="text" name="domain_name" placeholder="example.com" required>
                        <button type="submit">Get DNS Records</button>
                    </fieldset>
                </form>
                <div id="domain-add-status"></div>
            </article>

            <!-- Domain add result card (hidden by default) -->
            <article id="domain-result-card" hidden>
                <header><h3>DNS Configuration for <span id="domain-result-name"></span></h3></header>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Name</th>
                                <th>Value</th>
                                <th>Priority</th>
                            </tr>
                        </thead>
                        <tbody id="domain-dns-records"></tbody>
                    </table>
                </div>
                <footer>
                    <p class="domain-step-label">Step 1: Add these DNS records to your domain's DNS provider</p>
                    <div class="btn-group">
                        <button type="button" id="btn-download-zone" class="secondary">Download Zone File</button>
                        <button type="button" id="btn-push-cloudflare" class="contrast" hidden>Push to Cloudflare</button>
                    </div>
                    <hr>
                    <p class="domain-step-label">Step 2: Once DNS records are in place, register the domain</p>
                    <div class="btn-group">
                        <button type="button" id="btn-register-purelymail">Register on Purelymail</button>
                    </div>
                    <div id="domain-register-status"></div>
                </footer>
            </article>

            <article>
                <header><h3>Domain List</h3></header>
                <div class="field-hint">Use "Check DNS" to ask Purelymail to re-verify a domain's DNS records after making changes at your DNS provider.</div>
                <div id="domains-loading" class="loading" hidden>
                    <span aria-busy="true">Loading domains...</span>
                </div>
                <div id="domains-list"></div>
            </article>
        </section>

        <!-- ========== USERS PAGE ========== -->
        <section id="page-users" role="tabpanel" aria-labelledby="tab-users" hidden>
            <h2>Users</h2>

            <article>
                <header><h3>Create Users</h3></header>
                <form id="form-add-users">
                    <label>
                        Domain
                        <select id="users-domain-picker" name="domain_name" required>
                            <option value="">Select a domain</option>
                        </select>
                    </label>
                    <label>
                        Usernames <small>(one per line)</small>
                        <textarea name="usernames" rows="4" placeholder="alice&#10;bob&#10;carol" required></textarea>
                    </label>
                    <button type="submit">Create Users</button>
                </form>
                <div id="users-add-status"></div>
            </article>

            <!-- User creation result card (hidden by default) -->
            <article id="users-result-card" hidden>
                <header>
                    <div class="header-with-action">
                        <h3>Created Users</h3>
                        <button type="button" id="btn-copy-credentials" class="secondary outline btn-sm">Copy All</button>
                    </div>
                </header>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Password</th>
                                <th>Webmail</th>
                            </tr>
                        </thead>
                        <tbody id="users-created-table"></tbody>
                    </table>
                </div>
            </article>

            <article>
                <details id="mail-settings-details">
                    <summary><strong>Mail Client Settings</strong></summary>
                    <div id="mail-settings-content"></div>
                </details>
            </article>

            <article>
                <header><h3>Existing Users</h3></header>
                <label>
                    Filter by domain
                    <select id="users-list-domain-picker" aria-label="Filter users by domain">
                        <option value="">Select a domain</option>
                    </select>
                </label>
                <div id="users-loading" class="loading" hidden>
                    <span aria-busy="true">Loading users...</span>
                </div>
                <div id="users-list"></div>
            </article>
        </section>

        <!-- ========== ROUTING PAGE ========== -->
        <section id="page-routing" role="tabpanel" aria-labelledby="tab-routing" hidden>
            <h2>Routing</h2>

            <article>
                <header><h3>Add Routing Rule</h3></header>
                <form id="form-add-routing">
                    <div class="grid">
                        <label>
                            Domain
                            <select id="routing-domain-picker" name="domain_name" required>
                                <option value="">Select a domain</option>
                            </select>
                        </label>
                        <label>
                            Match Type
                            <select id="routing-match-type" name="match_type">
                                <option value="exact">Exact address</option>
                                <option value="prefix">Prefix match</option>
                                <option value="catchall">Catch-all</option>
                            </select>
                        </label>
                    </div>
                    <label id="routing-match-user-label">
                        Match User <small>(local part, e.g. "info")</small>
                        <input type="text" name="match_user" placeholder="info">
                    </label>
                    <label>
                        Forward To <small>(one email per line)</small>
                        <textarea name="target_addresses" rows="3" placeholder="bob@example.com&#10;carol@example.com" required></textarea>
                    </label>
                    <button type="submit">Create Rule</button>
                </form>
                <div id="routing-add-status"></div>
            </article>

            <article>
                <header><h3>Existing Rules</h3></header>
                <label>
                    Filter by domain
                    <select id="routing-list-domain-picker" aria-label="Filter rules by domain">
                        <option value="">All domains</option>
                    </select>
                </label>
                <div id="routing-loading" class="loading" hidden>
                    <span aria-busy="true">Loading rules...</span>
                </div>
                <div id="routing-list"></div>
            </article>
        </section>

        <!-- ========== HISTORY PAGE ========== -->
        <section id="page-history" role="tabpanel" aria-labelledby="tab-history" hidden>
            <h2>History</h2>

            <div class="search-bar">
                <input type="search" id="history-search" placeholder="Search emails, domains..." aria-label="Search history">
            </div>

            <div id="history-loading" class="loading" hidden>
                <span aria-busy="true">Searching...</span>
            </div>

            <article>
                <header><h3>Created Users</h3></header>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Password</th>
                                <th>Domain</th>
                                <th>Account</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody id="history-users-table"></tbody>
                    </table>
                </div>
                <div id="history-users-empty" class="empty-state" hidden>No users found.</div>
            </article>

            <article>
                <header><h3>Created Domains</h3></header>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Domain</th>
                                <th>Account</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody id="history-domains-table"></tbody>
                    </table>
                </div>
                <div id="history-domains-empty" class="empty-state" hidden>No domains found.</div>
            </article>
        </section>
    </main>

    <script src="/static/app.js"></script>
</body>
</html>
